'use strict';

const bcrypt = require('bcryptjs');

module.exports = {
  async up(queryInterface, Sequelize) {
    const saltRounds = 10;

    const users = await queryInterface.sequelize.query(
      'SELECT user_id, mosque_id, username, email, name FROM users;',
      { type: queryInterface.sequelize.QueryTypes.SELECT }
    );

    const userMap = {};
    users.forEach(user => {
      userMap[user.user_id] = user;
    });

    const activationsPlain = [
      {
        user_id: 1,
        mosque_id: 1,
        activation_type: 'activation',
        username: 'ahmad_01',
        password: 'password_ahmad_01',
        email: 'ahmad@example.com',
        proof_number: 'TXN-001-2025',
        proof_image: 'proof1.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Falah',
        mosque_address: 'Jl. Raya Utama No.123',
        mosque_phone_whatsapp: '08123456789',
        mosque_email: 'info@alfalah.id',
        mosque_facebook: 'facebook.com/masjidalfalah',
        mosque_instagram: 'instagram.com/masjidalfalah',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 1,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 3,
        mosque_id: 3,
        activation_type: 'activation',
        username: 'siti_nur',
        password: 'password_siti_03',
        email: 'sitinur@example.com',
        proof_number: 'TXN-003-2025',
        proof_image: 'proof3.jpg',
        status: 'pending',
        mosque_name: 'Masjid Nurul Iman',
        mosque_address: 'Jl. Kenanga No.7',
        mosque_phone_whatsapp: '08129876543',
        mosque_email: 'info@nuruliman.id',
        mosque_facebook: 'facebook.com/masjidnuruliman',
        mosque_instagram: 'instagram.com/masjidnuruliman',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: 2,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 5,
        mosque_id: 5,
        activation_type: 'activation',
        username: 'rina_amelia',
        password: 'password_rina_05',
        email: 'rina@example.com',
        proof_number: 'TXN-005-2025',
        proof_image: 'proof5.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Hikmah',
        mosque_address: 'Jl. Durian No.9',
        mosque_phone_whatsapp: '08229998888',
        mosque_email: 'info@alhikmah.id',
        mosque_facebook: 'facebook.com/alhikmah',
        mosque_instagram: 'instagram.com/alhikmah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 7,
        mosque_id: 7,
        activation_type: 'activation',
        username: 'dina_sari',
        password: 'password_dina_07',
        email: 'dina@example.com',
        proof_number: 'TXN-007-2025',
        proof_image: 'proof7.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Amanah',
        mosque_address: 'Jl. Mawar No.10',
        mosque_phone_whatsapp: '08136667777',
        mosque_email: 'info@alamanah.id',
        mosque_facebook: 'facebook.com/alamanah',
        mosque_instagram: 'instagram.com/alamanah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 9,
        mosque_id: 9,
        activation_type: 'activation',
        username: 'lina_putri',
        password: 'password_lina_09',
        email: 'lina@example.com',
        proof_number: 'TXN-009-2025',
        proof_image: 'proof9.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Ma\'ruf',
        mosque_address: 'Jl. Anggrek No.33',
        mosque_phone_whatsapp: '08224441122',
        mosque_email: 'info@almaaruf.id',
        mosque_facebook: 'facebook.com/almaaruf',
        mosque_instagram: 'instagram.com/almaaruf',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: 3,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 11,
        mosque_id: 11,
        activation_type: 'activation',
        username: 'rani_saputra',
        password: 'password_rani_11',
        email: 'rani@example.com',
        proof_number: 'TXN-011-2025',
        proof_image: 'proof11.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Mujahidin',
        mosque_address: 'Jl. Melur No.50',
        mosque_phone_whatsapp: '08129990000',
        mosque_email: 'info@almujahidin.id',
        mosque_facebook: 'facebook.com/almujahidin',
        mosque_instagram: 'instagram.com/almujahidin',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 1,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 13,
        mosque_id: 13,
        activation_type: 'activation',
        username: 'sari_wati',
        password: 'password_sari_13',
        email: 'sari@example.com',
        proof_number: 'TXN-013-2025',
        proof_image: 'proof13.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Hidayah',
        mosque_address: 'Jl. Cempaka No.11',
        mosque_phone_whatsapp: '08135551111',
        mosque_email: 'info@alhidayah.id',
        mosque_facebook: 'facebook.com/alhidayah',
        mosque_instagram: 'instagram.com/alhidayah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 15,
        mosque_id: 15,
        activation_type: 'activation',
        username: 'lia_kurnia',
        password: 'password_lia_15',
        email: 'lia@example.com',
        proof_number: 'TXN-015-2025',
        proof_image: 'proof15.jpg',
        status: 'pending',
        mosque_name: 'Masjid An-Nur',
        mosque_address: 'Jl. Flamboyan No.5',
        mosque_phone_whatsapp: '08134442222',
        mosque_email: 'info@annur.id',
        mosque_facebook: 'facebook.com/annur',
        mosque_instagram: 'instagram.com/annur',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 16,
        mosque_id: 16,
        activation_type: 'activation',
        username: 'ali_hakim',
        password: 'password_ali_16',
        email: 'ali@example.com',
        proof_number: 'TXN-016-2025',
        proof_image: 'proof16.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Mubarok',
        mosque_address: 'Jl. Melati No.21',
        mosque_phone_whatsapp: '08132221111',
        mosque_email: 'info@almubarok.id',
        mosque_facebook: 'facebook.com/almubarok',
        mosque_instagram: 'instagram.com/almubarok',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 2,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 17,
        mosque_id: 17,
        activation_type: 'activation',
        username: 'nova_putri',
        password: 'password_nova_17',
        email: 'nova@example.com',
        proof_number: 'TXN-017-2025',
        proof_image: 'proof17.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Ikhlas',
        mosque_address: 'Jl. Kenanga No.45',
        mosque_phone_whatsapp: '08135558888',
        mosque_email: 'info@alikhlas.id',
        mosque_facebook: 'facebook.com/alikhlas',
        mosque_instagram: 'instagram.com/alikhlas',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 18,
        mosque_id: 18,
        activation_type: 'activation',
        username: 'rizky_awan',
        password: 'password_rizky_18',
        email: 'rizky@example.com',
        proof_number: 'TXN-018-2025',
        proof_image: 'proof18.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Barokah',
        mosque_address: 'Jl. Anggrek No.28',
        mosque_phone_whatsapp: '08133336666',
        mosque_email: 'info@albarokah.id',
        mosque_facebook: 'facebook.com/albarokah',
        mosque_instagram: 'instagram.com/albarokah',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 1,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 19,
        mosque_id: 19,
        activation_type: 'activation',
        username: 'tiara_melati',
        password: 'password_tiara_19',
        email: 'tiara@example.com',
        proof_number: 'TXN-019-2025',
        proof_image: 'proof19.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Mutmainah',
        mosque_address: 'Jl. Sakura No.6',
        mosque_phone_whatsapp: '08134441111',
        mosque_email: 'info@almutmainah.id',
        mosque_facebook: 'facebook.com/almutmainah',
        mosque_instagram: 'instagram.com/almutmainah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      // Extension records - use data from users table
      {
        user_id: 2,
        mosque_id: userMap[2]?.mosque_id || 2,
        activation_type: 'extension',
        username: userMap[2]?.username || 'admin_annur2',
        password: 'password_admin2',
        email: userMap[2]?.email || 'admin2@annur.com',
        proof_number: 'TXN-002-2025',
        proof_image: 'proof2.jpg',
        status: 'pending',
        mosque_name: 'Masjid Baitul Hikmah',
        mosque_address: 'Jl. Pendidikan No.45',
        mosque_phone_whatsapp: '082233445566',
        mosque_email: 'baitulhikmah@example.com',
        mosque_facebook: 'facebook.com/baitulhikmah',
        mosque_instagram: 'instagram.com/baitulhikmah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 4,
        mosque_id: userMap[4]?.mosque_id || 4,
        activation_type: 'extension',
        username: userMap[4]?.username || 'admin_annur4',
        password: 'password_admin4',
        email: userMap[4]?.email || 'admin4@annur.com',
        proof_number: 'TXN-004-2025',
        proof_image: 'proof4.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Muttaqin',
        mosque_address: 'Jl. Melati No.19',
        mosque_phone_whatsapp: '08135557777',
        mosque_email: 'info@almuttaqin.id',
        mosque_facebook: 'facebook.com/almuttaqin',
        mosque_instagram: 'instagram.com/almuttaqin',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 3,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 6,
        mosque_id: userMap[6]?.mosque_id || 6,
        activation_type: 'extension',
        username: userMap[6]?.username || 'admin_annur6',
        password: 'password_admin6',
        email: userMap[6]?.email || 'admin6@annur.com',
        proof_number: 'TXN-006-2025',
        proof_image: 'proof6.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Ikhlas',
        mosque_address: 'Jl. Kenari No.88',
        mosque_phone_whatsapp: '08137776655',
        mosque_email: 'info@alikhlas.id',
        mosque_facebook: 'facebook.com/alikhlas',
        mosque_instagram: 'instagram.com/alikhlas',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 1,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 8,
        mosque_id: userMap[8]?.mosque_id || 8,
        activation_type: 'extension',
        username: userMap[8]?.username || 'admin_annur8',
        password: 'password_admin8',
        email: userMap[8]?.email || 'admin8@annur.com',
        proof_number: 'TXN-008-2025',
        proof_image: 'proof8.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Barokah',
        mosque_address: 'Jl. Kenanga No.21',
        mosque_phone_whatsapp: '08135554433',
        mosque_email: 'info@albarokah.id',
        mosque_facebook: 'facebook.com/albarokah',
        mosque_instagram: 'instagram.com/albarokah',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 2,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 10,
        mosque_id: userMap[10]?.mosque_id || 10,
        activation_type: 'extension',
        username: userMap[10]?.username || 'admin_annur10',
        password: 'password_admin10',
        email: userMap[10]?.email || 'admin10@annur.com',
        proof_number: 'TXN-010-2025',
        proof_image: 'proof10.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Mutmainah',
        mosque_address: 'Jl. Melati No.15',
        mosque_phone_whatsapp: '08135551234',
        mosque_email: 'info@almutmainah.id',
        mosque_facebook: 'facebook.com/almutmainah',
        mosque_instagram: 'instagram.com/almutmainah',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 12,
        mosque_id: userMap[12]?.mosque_id || 12,
        activation_type: 'extension',
        username: userMap[12]?.username || 'admin_annur12',
        password: 'password_admin12',
        email: userMap[12]?.email || 'admin12@annur.com',
        proof_number: 'TXN-012-2025',
        proof_image: 'proof12.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Furqan',
        mosque_address: 'Jl. Mawar No.3',
        mosque_phone_whatsapp: '08134445555',
        mosque_email: 'info@alfurqan.id',
        mosque_facebook: 'facebook.com/alfurqan',
        mosque_instagram: 'instagram.com/alfurqan',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 14,
        mosque_id: userMap[14]?.mosque_id || 14,
        activation_type: 'extension',
        username: userMap[14]?.username || 'admin_alfalah14',
        password: 'password_admin14',
        email: userMap[14]?.email || 'admin14@alfalah.com',
        proof_number: 'TXN-014-2025',
        proof_image: 'proof14.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Muttaqin',
        mosque_address: 'Jl. Cemara No.7',
        mosque_phone_whatsapp: '08134449999',
        mosque_email: 'info@almuttaqin.id',
        mosque_facebook: 'facebook.com/almuttaqin',
        mosque_instagram: 'instagram.com/almuttaqin',
        submitted_at: new Date(),
        approved_at: new Date(),
        admin_id: 2,
        created_at: new Date(),
        updated_at: new Date(),
      },
      {
        user_id: 20,
        mosque_id: userMap[20]?.mosque_id || 20,
        activation_type: 'extension',
        username: userMap[20]?.username || 'admin_alfurqan20',
        password: 'password_admin20',
        email: userMap[20]?.email || 'admin20@alfurqan.com',
        proof_number: 'TXN-020-2025',
        proof_image: 'proof20.jpg',
        status: 'pending',
        mosque_name: 'Masjid Al-Jihad',
        mosque_address: 'Jl. Durian No.12',
        mosque_phone_whatsapp: '08137779999',
        mosque_email: 'info@aljihad.id',
        mosque_facebook: 'facebook.com/aljihad',
        mosque_instagram: 'instagram.com/aljihad',
        submitted_at: new Date(),
        approved_at: null,
        admin_id: null,
        created_at: new Date(),
        updated_at: new Date(),
      },
    ];

    // Hash passwords
    const activations = await Promise.all(
      activationsPlain.map(async (activation) => {
        if (activation.password) {
          const hashedPassword = await bcrypt.hash(activation.password, 10);
          return { ...activation, password: hashedPassword };
        }
        return activation; 
      })
    );

    await queryInterface.bulkInsert('activations', activations, {});
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.bulkDelete('activations', null, {});
  }
};